# Процесс TC39 для внесения новых возможностей языка в спецификацию ECMAScript

Этот пост описывает детали нового процесса подготовки релизов, которым
будут руководствоваться при внесении новых возможностей в язык,
начиная с ECMAScript 2016 (ES7).

Материалы по теме:

* [Список того, что появится в ECMAScript 2016 (ES7)][15]
* [Нововведения, за которыми стоит наблюдать: ECMAScript 2017][16]


## Кто разрабатывает ECMAScript?

**Ответ:** TC39 (Технический Комитет 39).

[TC39][1] — это комитет, который занимается развитием JavaScript. Его членами
являются компании (помимо прочих, все основные производители браузеров).
[TC39 регулярно собирается][2], на встречах присутствуют участники, представляющие
интересы компаний, и приглашенные эксперты. Протоколы встреч [доступны онлайн][3]
и дают представление о том, как работает TC39.

Термин *член TC39* относится к человеку. Это значит:
делегат компании, которая является членом TC39.

Надо отметить, что TC39 управляется консенсусом: решения принимаются
большинством голосов и если никто не возражает настолько, что бы наложить вето.
Для многих членов согласие означает вполне реальные обязательства (они должны
будут внедрить новые возможности языка и т.д.).


## Как разрабатывается ECMAScript?

### Проблема: релиз ECMAScript 2015 (ES6) был слишком большим

Последний релиз ECMAScript — ES6, он большой, и создавался на протяжении практически
6 лет после выхода ES5 (с декабря 2009 по июнь 2015). Две основные проблемы с
такими длинными перерывами между релизами:

* Возможности языка, которые готовы раньше, чем релиз, ждут, пока релиз будет
полностью готов.

* Если реализация некой возможности языка требует времени, то люди, занимающиеся
спецификацией, находятся под постоянным давлением, требованиями закругляться, потому что,
если отложить реализацию до следующего релиза, ждать придется
долго. А ещё внесение новых возможностей может задержать выход релиза.

Вот почему начиная со спецификации ECMAScript 2016 (ES7) релизы будут выпускаться чаще и,
как следствие, будут меньше. Релиз будет происходить раз в год и он будет включать всё,
что будет готово к дедлайну.


### Решение: процесс TC39

Каждое предложение по добавлению новой возможности в ECMAScript в процессе *созревания*
проходит описанные ниже стадии, начиная со нулевой. Переход от одной стадии к другой
должен быть утвержден TC39.


#### Стадия 0: идея

**Что это?** Отправка идей по развитию ECMAScript, сформулированных в свободной форме. Отправлять идеи могут
либо члены TC39, либо люди, [зарегистрированные как контрибьюторы TC39][4].

**Что требуется?** Документ должен быть рассмотрен на встрече TC39 ([источник][5]),
после чего он вносится [на страницу с предложениями, находящимися на нулевой стадии][6].


#### Стадия 1: предложение

**Что это?** Формальное предложение новой возможности языка.

**Что требуется?** Должен быть выбран так называемый **герой**, который будет ответственен
за предложение. Либо герой, либо помощник героя должен быть членом TC39 ([источник][5]).
В предложении должна быть описана проблема, которую решает новая возможность языка. Решение
этой проблемы должно быть описано с помощью примеров, API и обсуждения семантики и алгоритмов.
И, наконец, должны быть описаны возможные препятствия для внесения новой возможности языка
в спецификацию, такие, как, например, её взаимодействие с другими элементами и проблемы имплементации.
Нужны имплементации, полифилы и примеры.

**Что дальше?** Принимая предложение, которое находится на стадии 1, TC39 показывает свое желание
проверить, обсудить и внести свой вклад в документ. Далее предложение ждут значительные изменения.


#### Шаг 2: черновик

**Что это?** Первая версия того, что будет в спецификации. На этой стадии появляется вероятность
скорого включения новой возможности в стандарт.

**Что требуется?** В предложение должно быть добавлено формальное описание синтаксиса и семантики
новой возможности языка (используя формальный язык спецификации ECMAScript). Описание должно быть
настолько точным, насколько это возможно, но может содержать todo и заготовки разделов, которые
будут заполнены в будущем. Нужно два экспериментальных внедрения новой возможности, но одна из
них может быть в транспилере, например в Babel.

**Что дальше?** C этого момента ожидается только постепенная эволюция черновика.


#### Шаг 3: кандидат

**Что это?** Документ почти закончен, и теперь для того, что бы двигаться дальше, нужны отзывы от
имплементаторов и пользователей.

**Что требуется?** Нужно дописать текст спецификации. Назначаются рецензенты (они назначаются TC39, но не героем), и
редактор спецификации ECMAScript должен подписать текст спецификации. Должно быть как минимум два
совместимых со спецификацией внедрения (которые могут быть выключены по умолчанию).

**Что дальше?** Дальше изменения происходят только в связи с критическими проблемами, обнаруженными в
процессе внедрения и использования новой возможности языка.


#### Стадия 4: финал

**Что это?** Предложение готово для внесения в стандарт.

**Что требуется?** Прежде чем предложение достигнет этой стадии, требуется:

* [Прохождение Test262][7] (строго говоря, это юнит-тесты возможностей языка, написанные на JavaScript).
* Два совместимых со спецификацией внедрения, которые проходят тесты.
* Значительный практический опыт применения.
* Редактор ECMAScript должен подписать текст спецификации.

**Что дальше?** Предложение будет включено в спецификацию ECMAScript, как только это будет возможно.
Когда спецификация пройдет ежегодную ратификацию в качестве стандарта, предложение будет ратифицировано
как её часть.


### Не называйте новые возможностью частью ECMAScript

Как видите, только когда предложение достигнет 4 стадии, можно быть уверенным, что оно будет включено в
стандарт. Тогда возможно его включение в следующий релиз ECMAScript, но на 100% уверенным в этом быть
всё же нельзя (это может занять больше времени, чем предполагалось изначально). Так что нельзя больше называть предложения
«возможностью ES7» или «новой возможностью ES2016», и теперь мои любимые шапки для статей и постов
выглядят так:

* Предложение ECMAScript: возможность foo. Стадия рассмотрения предложения указана в начале статьи.
* ES.стадия 2: возможность foo.

Если предложение переходит на стадию 4, я согласен называть это новой возможностью ES20xx, но
безопаснее подождать пока редактор спецификации подтвердит то, в какой релиз это предложение будет
включено. `Object.observe` — пример предложения для ECMAScript, которое перешло на стадию 2, но было в
конечном счете отозвано.


### Материалы для дальнейшего изучения

Следующие материалы были важными источниками информации при написании этого поста:

* [Репозиторий ecma262 на GitHub (ECMA-262 это идентификатор стандарта ECMAScript)][17], который содержит:
  * [README, который содержит все предложения, которые находятся на первой стадии или выше][18]
  * [Список предложений, которые находятся на нулевой стадии][6]
  * [Ответы на часто задаваемые вопросы, касающиеся ECMA-262][5]
* [Документ, описывающий процесс работы TC39][19]

Кроме того, можно прочитать:

* [Таблица совместимости ES7 Кангакса (Kangax)][20] показывает, какие предложения где поддерживаются, и группирует их по стадии, на которой они находятся
* Дополнительную информацию по поводу процесса разработки ES6 можно найти в разделе «[Как разрабатывался стандарт ECMAScript 6][21]» книги «Исследуем ES6».

[1]: http://www.ecma-international.org/memento/TC39.htm
[2]: http://www.ecma-international.org/memento/TC39-M.htm
[3]: https://github.com/tc39/tc39-notes

[4]: http://www.ecma-international.org/memento/contribute_TC39_Royalty_Free_Task_Group.php
[5]: https://github.com/tc39/ecma262/blob/master/FAQ.md
[6]: https://github.com/tc39/ecma262/blob/master/stage0.md
[7]: https://github.com/tc39/test262
[8]: https://github.com/rwaldron/exponentiation-operator
[9]: http://speakingjs.com/es5/ch11.html#two_zeros

[10]: https://esdiscuss.org/topic/having-a-non-enumerable-array-prototype-contains-may-not-be-web-compatible

[11]: http://exploringjs.com/es6/ch_strings.html#leanpub-auto-checking-for-containment-and-repeating-strings
[12]: https://github.com/tc39/Array.prototype.includes/
[13]: https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions
[14]: https://fetch.spec.whatwg.org/#concept-request

[15]: http://frontender.info/ecmascript-2016/
[16]: http://www.2ality.com/2016/02/ecmascript-2017.html
[17]: https://github.com/tc39/ecma262
[18]: https://github.com/tc39/ecma262/blob/master/README.md
[19]: https://tc39.github.io/process-document/
[20]: https://kangax.github.io/compat-table/es7/
[21]: http://exploringjs.com/es6/ch_about-es6.html#_how-ecmascript-6-was-designed
